<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Acceso - Poker Lab Pro</title>
    <style>
        body { background: #080808; color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #121212; padding: 40px; border-radius: 15px; border: 1px solid #f1c40f; text-align: center; max-width: 400px; }
        .btn-pay { background: #635bff; color: white; padding: 12px 20px; border-radius: 5px; text-decoration: none; font-weight: bold; display: none; margin-top: 20px; }
        #user-button { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="card">
        <h1 style="color:#f1c40f">POKER LAB PRO</h1>
        <div id="auth-content">Cargando...</div>
        <div id="user-button"></div>
        
        <div id="payment-section" style="display:none;">
            <p>Requiere suscripción activa para acceder.</p>
            <stripe-buy-button 
                buy-button-id="buy_btn_1SvLtdEqI6UldDzdYO4nwfJo" 
                publishable-key="pk_live_51SubhvEqI6UldDzdLs9yssCFIRbva99l1tRMqee9YWok5WXN15szzV0mfTnPABmj0N6NFigfeAp8WXPURNx4wfeZ0050UNvray">
            </stripe-buy-button>
        </div>

        <div id="manage-subscription" style="display:none; margin-top:20px;">
            <a href="https://billing.stripe.com/p/login/00w5kD9QDgYWbVp66o9fW00" target="_blank" style="color:#888; font-size:12px;">Gestionar Suscripción / Cancelar</a>
        </div>
    </div>

    <script async crossorigin="anonymous" data-clerk-publishable-key="pk_test_bmV4dC1tYWtvLTEuY2xlcmsuYWNjb3VudHMuZGV2JA" src="https://next-mako-1.clerk.accounts.dev/npm/@clerk/clerk-js@5/dist/clerk.browser.js" type="text/javascript"></script>

    <script>
        window.addEventListener('load', async function () {
            await Clerk.load();

            if (!Clerk.user) {
                Clerk.mountSignIn(document.getElementById('auth-content'));
            } else {
                const status = Clerk.user.publicMetadata.status; // 'active' o undefined
                const stripeId = Clerk.user.publicMetadata.stripeCustomerId;

                if (status === 'active') {
                    document.getElementById('auth-content').innerHTML = "<h3>Acceso Concedido</h3><p>Redirigiendo al Lab...</p>";
                    setTimeout(() => { window.location.href = 'app.html'; }, 2000);
                } else {
                    document.getElementById('auth-content').innerHTML = "<h3>Hola, " + Clerk.user.firstName + "</h3>";
                    document.getElementById('payment-section').style.display = 'block';
                    Clerk.mountUserButton(document.getElementById('user-button'));
                }

                if (stripeId) {
                    document.getElementById('manage-subscription').style.display = 'block';
                }
            }
        });
    </script>
</body>
</html>
